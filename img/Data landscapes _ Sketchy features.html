
<!DOCTYPE html>
<html>
  <head>
    <title>Data landscapes | Sketchy features</title>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    
    <script src="jquery.min.js"></script>
    <script src="jquery-ui.js"></script>
    <script src="jquery.ui.touch-punch.min.js"></script>
    <link href="bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata&family=Londrina+Solid&family=Noto+Serif&display=swap" rel="stylesheet">
    <link rel="icon" href="logo.png">
    <link href="main.css?12125" type="text/css" rel="stylesheet">
  </head>
  <body>
    <div class="loading" style="display:none">
      <div class="spinner">
        <div class="rect1"></div>
        <div class="rect2"></div>
        <div class="rect3"></div>
        <div class="rect4"></div>
        <div class="rect5"></div>
      </div>
    </div>
    <div class="container container-fluid" id='app'>
      <div id='header'>
      <span class="glyphicon glyphicon-info-sign"></span> The data landscape apps have been designed to be used with the <b>Chrome browser</b> and with devices that have medium to large screen sizes (not phones).
      </div>
      <div id="data-landscape" class="section level2 page">
      <h2>Sketchy features</h2>
      <p>Select word/concept/thing: <select id='search_term'></select>
      <button id='create'>Get drawings</button></p>
     <div id="content">
        
      <div id='message' style='display:none'></div>
        
      <div class='row'>
        <div id='lefter' class='col-xs-4'></div>
        <div id='sorter' class='col-xs-4'></div>
        <div id='righter' class='col-xs-4'></div>
      </div>
        
       <div class='row'>
        <div id='left' class='col-xs-4 sorty connectedSortable' style='min-height:600px'></div>
        <div id='sort' class='col-xs-4 sorty connectedSortable'></div>
        <div id='right' class='col-xs-4 sorty connectedSortable' style='min-height:600px'></div>
      </div>
      
      <div id="datay" class="row">
      </div>
      
      </div>
      </div>
      <script type="text/javascript">
      var categories = ["aircraft carrier", "airplane", "alarm clock", "ambulance", "angel", "animal migration", "ant", "anvil", "apple", "arm", "asparagus", "axe", "backpack", "banana", "bandage", "barn", "baseball", "baseball bat", "basket", "basketball", "bat", "bathtub", "beach", "bear", "beard", "bed", "bee", "belt", "bench", "bicycle", "binoculars", "bird", "birthday cake", "blackberry", "blueberry", "book", "boomerang", "bottlecap", "bowtie", "bracelet", "brain", "bread", "bridge", "broccoli", "broom", "bucket", "bulldozer", "bus", "bush", "butterfly", "cactus", "cake", "calculator", "calendar", "camel", "camera", "camouflage", "campfire", "candle", "cannon", "canoe", "car", "carrot", "castle", "cat", "ceiling fan", "cello", "cell phone", "chair", "chandelier", "church", "circle", "clarinet", "clock", "cloud", "coffee cup", "compass", "computer", "cookie", "cooler", "couch", "cow", "crab", "crayon", "crocodile", "crown", "cruise ship", "cup", "diamond", "dishwasher", "diving board", "dog", "dolphin", "donut", "door", "dragon", "dresser", "drill", "drums", "duck", "dumbbell", "ear", "elbow", "elephant", "envelope", "eraser", "eye", "eyeglasses", "face", "fan", "feather", "fence", "finger", "fire hydrant", "fireplace", "firetruck", "fish", "flamingo", "flashlight", "flip flops", "floor lamp", "flower", "flying saucer", "foot", "fork", "frog", "frying pan", "garden", "garden hose", "giraffe", "goatee", "golf club", "grapes", "grass", "guitar", "hamburger", "hammer", "hand", "harp", "hat", "headphones", "hedgehog", "helicopter", "helmet", "hexagon", "hockey puck", "hockey stick", "horse", "hospital", "hot air balloon", "hot dog", "hot tub", "hourglass", "house", "house plant", "hurricane", "ice cream", "jacket", "jail", "kangaroo", "key", "keyboard", "knee", "knife", "ladder", "lantern", "laptop", "leaf", "leg", "light bulb", "lighter", "lighthouse", "lightning", "line", "lion", "lipstick", "lobster", "lollipop", "mailbox", "map", "marker", "matches", "megaphone", "mermaid", "microphone", "microwave", "monkey", "moon", "mosquito", "motorbike", "mountain", "mouse", "moustache", "mouth", "mug", "mushroom", "nail", "necklace", "nose", "ocean", "octagon", "octopus", "onion", "oven", "owl", "paintbrush", "paint can", "palm tree", "panda", "pants", "paper clip", "parachute", "parrot", "passport", "peanut", "pear", "peas", "pencil", "penguin", "piano", "pickup truck", "picture frame", "pig", "pillow", "pineapple", "pizza", "pliers", "police car", "pond", "pool", "popsicle", "postcard", "potato", "power outlet", "purse", "rabbit", "raccoon", "radio", "rain", "rainbow", "rake", "remote control", "rhinoceros", "rifle", "river", "roller coaster", "rollerskates", "sailboat", "sandwich", "saw", "saxophone", "school bus", "scissors", "scorpion", "screwdriver", "sea turtle", "see saw", "shark", "sheep", "shoe", "shorts", "shovel", "sink", "skateboard", "skull", "skyscraper", "sleeping bag", "smiley face", "snail", "snake", "snorkel", "snowflake", "snowman", "soccer ball", "sock", "speedboat", "spider", "spoon", "spreadsheet", "square", "squiggle", "squirrel", "stairs", "star", "steak", "stereo", "stethoscope", "stitches", "stop sign", "stove", "strawberry", "streetlight", "string bean", "submarine", "suitcase", "sun", "swan", "sweater", "swing set", "sword", "syringe", "table", "teapot", "teddy-bear", "telephone", "television", "tennis racquet", "tent", "The Eiffel Tower", "The Great Wall of China", "The Mona Lisa", "tiger", "toaster", "toe", "toilet", "tooth", "toothbrush", "toothpaste", "tornado", "tractor", "traffic light", "train", "tree", "triangle", "trombone", "truck", "trumpet", "t-shirt", "umbrella", "underwear", "van", "vase", "violin", "washing machine", "watermelon", "waterslide", "whale", "wheel", "windmill", "wine bottle", "wine glass", "wristwatch", "yoga", "zebra", "zigzag"];

      for(var i=0; i<categories.length; i++)
      {
        $("#search_term").append("<option>" + categories[i] + "</option>")
      }

      var rand_item = Math.floor(categories.length * Math.random());
      $("#search_term>option:eq(" + rand_item + ")").prop('selected', true);

      $("#create").click(function(){

       var search_term = $("#search_term").val();
       //need to check doesn't have translation on
       var regex = /^[a-zA-Z0-9 \-]*$/;

       if(search_term == ""){
          $("#content").html("<span class='warning'>You need to select the word/concept for the drawings!</span>")
       } else if (!regex.test(search_term)) {
         $("#content").html("<span class='warning'>Make sure your browser is showing the page in the English language!</span>")
       }
       else
       {
        $(".sorty").html("");
        $("#datay").html("");
        $("#create").prop('disabled', true);
        $("#create").css("opacity",0.6);
        $('.loading').show();
        search_term = search_term.trim().split(" ").join(",");
        var opts = ["","1","2","3","4","5","6","7","8","9"];
       var url = "https://datalandscapes.online/data/quick_strokes" + opts[Math.floor(Math.random()*opts.length)] + ".php?search=" + search_term;
       //var url = "https://datalandscapes.online/data/quick_strokes.php?search=" + search_term;
        $.get(url, function(response) {
          response = JSON.parse(response);
          setupDrawings(response);
          $("#create").prop('disabled', false);
          $("#create").css("opacity",1);
          $('.loading').hide();
        });
       }
      })
      
      

      function setupDrawings(data){
        
        for(var i = 0; i < data.length; i++){
          
          if(data[i] !== ""){
            var drawing_array = data[i];
            var drawing = drawing_array.drawing;
            var key_id = drawing_array.key_id;
            var word = drawing_array.word;
            var country = drawing_array.countrycode;
			      var timestamp = drawing_array.timestamp;
            timestamp = timestamp.split(" ");
            var time = timestamp[1].split(".");
            var d = new Date(timestamp[0]);
            var dayName = d.toString().split(' ')[0];
			      var recognised = drawing_array.recognized;
            if(recognised){recognised = "yes"} else {recognised = "no"};
            var timeLast = 0;
            var pauseTime = 0;
            var countries = {AD:'N',AE:'N',AF:'N',AG:'N',AI:'N',AL:'N',AM:'N',AO:'S',AQ:'S',AR:'S',AS:'S',AT:'N',AU:'S',AW:'N',AX:'N',AZ:'N',BA:'N',BB:'N',BD:'N',BE:'N',BF:'N',BG:'N',BH:'N',BI:'S',BJ:'N',BL:'N',BM:'N',BN:'N',BO:'S',BQ:'N',BR:'S',BS:'N',BT:'N',BV:'S',BW:'S',BY:'N',BZ:'N',CA:'N',CC:'S',CD:'S',CF:'N',CG:'S',CH:'N',CI:'N',CK:'S',CL:'S',CM:'N',CN:'N',CO:'N',CR:'N',CU:'N',CV:'N',CW:'N',CX:'S',CY:'N',CZ:'N',DE:'N',DJ:'N',DK:'N',DM:'N',DO:'N',DZ:'N',EC:'S',EE:'N',EG:'N',EH:'N',ER:'N',ES:'N',ET:'N',FI:'N',FJ:'S',FK:'S',FM:'N',FO:'N',FR:'N',GA:'S',GB:'N',GD:'N',GE:'N',GF:'N',GG:'N',GH:'N',GI:'N',GL:'N',GM:'N',GN:'S',GP:'N',GQ:'N',GR:'N',GS:'S',GT:'N',GU:'N',GW:'N',GY:'N',HK:'N',HM:'S',HN:'N',HR:'N',HT:'N',HU:'N',ID:'S',IE:'N',IL:'N',IM:'N',IN:'N',IO:'S',IQ:'N',IR:'N',IS:'N',IT:'N',JE:'N',JM:'N',JO:'N',JP:'N',KE:'N',KG:'N',KH:'N',KI:'S',KM:'S',KN:'N',KP:'N',KR:'N',KW:'N',KY:'N',KZ:'N',LA:'N',LB:'N',LC:'N',LI:'N',LK:'N',LR:'N',LS:'S',LT:'N',LU:'N',LV:'N',LY:'N',MA:'N',MC:'N',MD:'N',ME:'N',MF:'N',MG:'S',MH:'N',MK:'N',ML:'N',MM:'N',MN:'N',MO:'N',MP:'S',MQ:'N',MR:'N',MS:'N',MT:'N',MU:'S',MV:'N',MW:'S',MX:'N',MY:'N',MZ:'S',NA:'S',NC:'S',NE:'N',NF:'S',NG:'N',NI:'N',NL:'N',NO:'N',NP:'N',NR:'S',NU:'S',NZ:'S',OM:'N',PA:'N',PE:'S',PF:'S',PG:'S',PH:'N',PK:'N',PL:'N',PM:'N',PN:'S',PR:'N',PS:'N',PT:'N',PW:'N',PY:'S',QA:'N',RE:'S',RO:'N',RS:'N',RU:'N',RW:'S',SA:'N',SB:'S',SC:'S',SD:'N',SE:'N',SG:'N',SH:'S',SI:'N',SJ:'N',SK:'N',SL:'N',SM:'N',SN:'N',SO:'N',SR:'N',SS:'N',ST:'N',SV:'N',SX:'N',SY:'N',SZ:'S',TC:'N',TD:'N',TF:'S',TG:'N',TH:'N',TJ:'N',TK:'S',TL:'S',TM:'N',TN:'N',TO:'S',TR:'N',TT:'N',TV:'S',TW:'N',TZ:'S',UA:'N',UG:'N',UM:'N',US:'N',UY:'S',UZ:'N',VA:'N',VC:'N',VE:'N',VG:'N',VI:'N',VN:'N',VU:'S',WF:'S',WS:'S',YE:'N',YT:'S',ZA:'S',ZM:'S',ZW:'S'};
            
          
            //preprocess to get left, right, top and bottom limits
            var leftX = drawing[0][0][0];
            var rightX = drawing[0][0][0];
            var topY = drawing[0][1][0];
            var bottomY = drawing[0][1][0];

            //preprocess
            for(var s=0; s<drawing.length; s++)
            {
              var strokes = drawing[s];
              var x = strokes[0];
              var y = strokes[1];
              var t = strokes[2];
             	for(var t=0; t<x.length;t++){
                     if(x[t] < leftX) leftX = x[t];
                     if(x[t] > rightX) rightX = x[t];
                     if(y[t] < topY) topY = y[t];
                     if(y[t] > bottomY) bottomY = y[t];
				      }
        
            }
            
            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');
            var drawWidth = 72; //pixels
            var square = Math.max((rightX - leftX), (bottomY - topY));
            canvas.width = square;
            canvas.height = square;
            var x_adjust = leftX + ((rightX - leftX) - square)/2;
            var y_adjust = topY + ((bottomY - topY) - square)/2;
            //context.lineWidth = 2;
            context.lineWidth = Math.ceil(square/drawWidth);
            context.strokeStyle = '#C74B4D';
            
           	for(var s=0; s<drawing.length; s++){
        				var strokes = drawing[s];
        				var x = strokes[0];
        				var y = strokes[1];
                var t = strokes[2];
           
                if(s == drawing.length - 1){
                  timeLast = t[t.length - 1];
                }
                
                if(s > 0){
                 var lastTime = drawing[s - 1][2];
                 pauseTime += (t[0] - lastTime[lastTime.length - 1]);
                } else
                {
                   pauseTime = t[0];
                }
          
				        context.beginPath();
				        context.moveTo(x[0] - x_adjust,y[0] - y_adjust);
        				for(var t=1; t<x.length;t++){
        					context.lineTo(x[t] - x_adjust,y[t] - y_adjust);
        				}
				
				        context.stroke();
                context.closePath();
			      }
                  

             var html = $("<img id = " + key_id + " class='draggy sort' style = 'background-color: #F0F0F0;' src='" + canvas.toDataURL() + "'>");
            

            html.data("id", key_id);
            html.data("label", "sort");
            html.data("recognised", recognised);
            html.data("num_strokes", drawing.length);
            html.data("draw_time", (timeLast/1000 - pauseTime/1000).toFixed(1));
            html.data("pause_time", (pauseTime/1000).toFixed(1));
            html.data("game_time", (timeLast/1000).toFixed(1));
            html.data("country", country);
            html.data("hemisphere", countries[country]);
            html.data("day", dayName);
            html.data("date_sketched", timestamp[0]);
            html.data("time_sketched", time[0]);
            html.data("search_word", word);
            
            $("#sort").append(html);

          }
          
        }
        
        doThings();

      }
      
       function doThings(){
      
      $("#inst").show();
      
       $("#lefter").html("<input class='labels' id='left_label' value='change_this_to_your_level_1'>");
        
        $("#righter").html("<input class='labels' id='right_label' value='change_this_to_your_level_2'>");
        
        $(".labels").on("input", function(){
          var data_label = $(this).val().split(" ").join("_").toLowerCase();
          if($(this).attr("id") == "left_label"){
            $(".lefty").each(function(){$(this).data("label", data_label)})
          }
          if($(this).attr("id") == "right_label"){
            $(".righty").each(function(){$(this).data("label", data_label)})
          }
          updateTable();
        });
        
        $(".sorty" ).sortable({
              connectWith: ".connectedSortable"
            }).disableSelection();
            
        $(".sorty" ).droppable({
            
          drop: function( event, ui ) {
            event.preventDefault();  
            event.stopPropagation();
            
            var dropped_into = $(this);
            var dropped_id = dropped_into.attr("id");
            
            var dot = $(ui.draggable);
            var id = dot.attr("id");
            
            if(dropped_id == "sort")
            {
               dot.removeClass("lefty");
               dot.removeClass("righty");
               dot.addClass("sort");
               dot.data("label", "sort");
            }
      
            if(dropped_id == "left")
            {
               dot.removeClass("righty");
               dot.addClass("lefty");
               dot.removeClass("sort");
               dot.data("label", $("#left_label").val().split(" ").join("_").toLowerCase());
            }
            
            if(dropped_id == "right")
            {
               dot.addClass("righty");
               dot.removeClass("lefty");
               dot.removeClass("sort");
               dot.data("label", $("#right_label").val().split(" ").join("_").toLowerCase());
            }
            
             updateTable();
      
          }
        }).disableSelection();
      }
 

      function updateTable(){
          $(".draggy").each(function(index){
            if(index == 0){
                var table = "<table id='data'><tr class='top_row'><td>sketch_feature</td><td>word_concept</td><td>recognised</td><td>num_strokes</td><td>draw_time</td><td>pause_time</td><td>game_time</td><td>country</td><td>hemisphere</td><td>day</td><td>date_sketched</td><td>time_sketched</td><td>date_generated</td></tr></table>";
                       var getData = "";
                var left = $(".lefty");
                var right = $(".righty");
                if(left.length + right.length == 60){
                    getData = "<button id='copy'><span class='glyphicon glyphicon-copy'></span> Copy </button> <button onclick='dataJump()'>Generate link to data</button>";
                }
                $("#datay").html(getData + "<div id='training_link' style='margin-top: 20px'></div><br>" + table);
                $("#copy").click(function(){
                  const table = document.querySelector("#data")
                  if (table) {
                   const blob = new Blob([table.outerHTML], { type: "text/html" });
                    const tableHtml = new ClipboardItem({ "text/html": blob });
                  
                    navigator.clipboard.write([tableHtml]).then(function () {
                    console.log('Async: Copying to clipboard was successful!');
                         }, function (err) {
                           console.error('Async: Could not copy text: ', err);
                         });
                  };
                })
            }
           var checkin = $(this).data("id");
            if($(this).data("label") !== "sort" && checkin !== undefined){
            var current_time = new Date();
            var check_time = current_time.getTime();
            $("#data tbody").append("<tr><td>" + $(this).data("label") + "</td><td>" + $(this).data("search_word") + "</td><td>" + $(this).data("recognised") + "</td><td>" + $(this).data("num_strokes") + "</td><td>" + $(this).data("draw_time") + "</td><td>" + $(this).data("pause_time") + "</td><td>" + $(this).data("game_time") + "</td><td>" + $(this).data("country") + "</td><td>" + $(this).data("hemisphere") + "</td><td>" + $(this).data("day") + "</td><td>" + $(this).data("date_sketched") + "</td><td>" + $(this).data("time_sketched") + "</td><td>" + check_time + "</td></tr>")
            }
            
            
          })
          
        
      }
      
      function dataJump(){
        var data = [];
        var col_names = [];
        $("#data tr:first").find("td").each(function(index){
          col_names.push($(this).text());
        });
        $("#data tr").each(function(index){
          if(index !== 0){
            var row = {};
            $(this).find("td").each(function(index){
                row[col_names[index]] = $(this).text();
            });
            data.push(row);
          }
        })
        var data_string1 = JSON.stringify(data);
        var opts = ["","1","2","3","4","5","6","7","8","9"];
        var url = "tempcsv" + opts[Math.floor(Math.random()*opts.length)] + ".php";
        $.post(url, {"t": data_string1}, function(response) {
          var url1 = "https://lite.docker.stat.auckland.ac.nz/?url=" + response + "&land=visualize";
          var link1 = "<a href='" + url1 + "' target='blank'>" + url1 + "</a>"
          var html = "<p><mark>Data as iNZight Lite link</mark>: " + link1 + "</p>";
          $("#training_link").html(html);

        }).fail(function(jqXHR, textStatus, errorThrown) {
var errorMessage = "<p><mark>Error: " + textStatus + " (" + jqXHR.status + ") - " + errorThrown + "</mark></p>";
    $("#training_link").html(errorMessage);
});
          
      }


      function shuffle(array) {
          var currentIndex = array.length, temporaryValue, randomIndex ;

          // While there remain elements to shuffle...
          while (0 !== currentIndex) {

              // Pick a remaining element...
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;

              // And swap it with the current element.
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
          }

      return array;
      }
      </script>
      <div id='footer'>
        <img class='brand' src='logo.png'>Data landscapes 
        <span>
          Developed by <a href="https://profiles.auckland.ac.nz/a-fergusson" target="blank">Anna Fergusson, University of Auckland</a>
        </span>
      </div>
    </div>
  </body>
</html>
